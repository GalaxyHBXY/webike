{% extends "base.html" %}
{% block content %}
    <div class="container-fluid px-0 d-flex h-100 main-sec" style="min-height: 50vh;">
        <div class="row d-flex justify-content-between h-100 m-0 py-4">
            <div class="col-12 col-lg-6">
                <img src="{{ product.image.url }}" class="card mx-auto" alt="product image"
                     style="height: 350px; width: 350px;">
            </div>
            <div class="col-12 col-lg-6" style="word-break: break-all;">
                <h2 class="text-dark mb-0">
                    {{ product.product_name }}
                </h2>
                <p class="text-muted">Yamaha</p>
                <p class="text-right">
                    {{ product.address }}
                    <a href="#" class="ml-2">
                        <button class="btn btn-outline-info">Search on map</button>
                    </a>
                </p>
                <p class="text-muted mb-1 d-inline-block"> Size: Large</p>
                <p class="text-muted mb-1 d-inline-block ml-4"> Color: Red </p>
                <p class="text-muted">
                    {#                        {{ product.description }}#}
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Pariatur, vitae, explicabo? Incidunt
                    facere, natus soluta dolores iusto! Molestiae expedita veritatis nesciunt doloremque sint asperiores
                    fuga voluptas, distinctio, aperiam, ratione dolore.

                    Ex numquam veritatis debitis minima quo error quam eos dolorum quidem perferendis. Quos repellat
                    dignissimos minus, eveniet nam voluptatibus molestias omnis reiciendis perspiciatis illum hic magni
                    iste, velit aperiam quis.
                </p>

                <h4 class="text-dark d-inline-block"> ${{ product.price | floatformat:"2" }} </h4>
                <p class="text-success m-0 d-inline-block ml-4 align-top">In Stock: 37</p>
                <div class="input-group my-3" style="max-width: 120px;">
                    <div class="input-group-prepend">
                        <button class="btn btn-outline-dark js-btn-minus" type="button">&minus;</button>
                    </div>
                    <input type="number" class="form-control text-center" value="1" placeholder=""
                           aria-label="Example text with button addon" aria-describedby="button-addon1">
                    <div class="input-group-append">
                        <button class="btn btn-outline-dark js-btn-plus" type="button">&plus;</button>
                    </div>
                </div>
                <button class="btn btn-info mt-2" id="checkout-button">Buy Now</button>
            </div>
        </div>
    </div>
    <span hidden id="email">{{ request.user.email }}</span>

    <script src="https://js.stripe.com/v3/"></script>
    <script type="text/javascript">
        // Create an instance of the Stripe object with your publishable API key
        var stripe = Stripe('{{ stripe_publishable_key }}');
        var checkoutButton = document.getElementById('checkout-button');

        checkoutButton.addEventListener('click', function () {

            var email = document.getElementById('email').innerHTML;
            if (email.length == 0) {
                alert("Please enter your email address.");
                return;
            }

            // Create a new Checkout Session using the server-side endpoint you
            // created in step 3.
            fetch("{% url 'api_checkout_session' id=product.id %}", {
                method: 'POST',
                body: JSON.stringify(
                    {email: email}
                )
            })
                .then(function (response) {
                    return response.json();
                })
                .then(function (session) {
                    return stripe.redirectToCheckout({sessionId: session.sessionId});
                })
                .then(function (result) {
                    // If `redirectToCheckout` fails due to a browser or network
                    // error, you should display the localized error message to your
                    // customer using `error.message`.
                    if (result.error) {
                        alert(result.error.message);
                    }
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        });
    </script>
{% endblock content %}