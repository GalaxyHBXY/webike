{% extends "base.html" %}
{% load static %}
{% block css %}
    <style>
        @media (max-width: 575px) {
            .product_img {
                width: 80px !important;
                height: 45px !important;
            }
        }
    </style>
{% endblock css %}
{% block content %}
    <div class="container-fluid px-0 h-100 main-sec" style="min-height: 50vh;">
        <div class="row d-flex justify-content-between h-100 m-0 py-4 w-100 mx-auto" style="max-width: 1800px;">
            <div class="row m-0 mx-auto" style="padding: 0; margin:0; width: 100%; max-width: 1800px;">
                <div class="col-lg-4 mx-auto" style="max-width: 400px;">
                    <div class="py-3 text-center" style="background-color: white; border-radius: 10px;">
                        <div class="mt-3">
                            <div class="mx-auto mt-3 border rounded p-5" style="width: 90%;">
                                <h5 class="text-secondary text-start mb-2 mt-0">Personal Information</h5>
                                <p>
                                    <strong>
                                        First Name: {{ user.customer.first_name }} {{ user.customer.user_id }}
                                    </strong>
                                </p>
                                <p>
                                    <strong>
                                        Last Name: {{ user.customer.last_name }}
                                    </strong>
                                </p>
                                <p>
                                    <strong>
                                        Email: {{ user.email }}
                                    </strong>
                                </p>
                                <p class="mb-0">
                                    <a href="/user/profile">
                                        <button class="btn btn-info">Information Settings</button>
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-lg-8 mt-3 mt-lg-0 mx-auto" style="max-width: 1400px!important;">
                    <div class="py-3 job_info_card h-100" style="background-color: white;border-radius: 10px;">
                        <div class="row text-center my-4 mx-0">
                            <h4 class="text-dark">Order History</h4>
                        </div>
                        <div style="max-width: 800px;">
                            {% for order in orders %}
                                {% if  order.customer_id == user.id %}

                                    <div class="card d-flex flex-wrap mb-3">
                                <div class="card-header d-flex flex-wrap w-100 p-2 text-white font-weight-bold"
                                     style="background-color: #17a2b8;">
                                    <p class="d-inline-block mb-0 font-italic">{{ order.created_on }}</p>
                                    <p class="d-inline-block ml-auto mb-0">Order ID: {{ order.id }}</p>
                                </div>
                                <div class="table-responsive">
                                    <table class="table m-0">
                                        <thead>
                                        <tr>
                                            <th scope="col" style="width: 80px;">Product</th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">Quantity</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>
                                                <img src=" {{ order.product.image.url }} "
                                                     class="mr-3 product_img"
                                                     alt="product_image"
                                                     width="160"
                                                     height="90"
                                                     style="object-fit: cover; aspect-ratio: 16/9;">
                                            </td>
                                            <td>{{ order.product.product_name }}</td>
                                            <td>{{ order.product.price }}</td>
                                            <td>x{{ order.quantity }}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="text-right p-3">
                                    <button class="btn btn-outline-secondary mr-3"
                                            data-toggle="modal"
                                            data-target="#exampleModal"
                                            data-merchant-name={{ order.product.merchant.merchant_name }}
                                            data-merchant-phone={{ order.product.merchant.user.phone }}
                                            data-merchant-email={{ order.product.merchant.user.email }}>Contact Merchant
                                    </button>
                                    <button class="btn btn-outline-info">
                                        <a href="{% url "product_detail" order.product.id %}"> View Details
                                        </a>
                                    </button>
                                </div>
                            </div>
                                {% endif %}
                            {% endfor %}

                        </div>
                    </div>
                </div>
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title text-dark" id="exampleModalLabel">Contact</h5>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <h6>Phone:</h6>
                                        <a id="modal-phone"></a>
                                    </div>
                                    <div class="form-group">
                                        <h6>Email:</h6>
                                        <a id="modal-email"></a>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}
{% block javascript %}
    <script>
        $('#exampleModal').on('show.bs.modal', function (event) {
            const button = $(event.relatedTarget); // Button that triggered the modal
            const merchant = button.data('merchant-name'); // Extract info from data-* attributes
            const email = button.data('merchant-email'); // Extract info from data-* attributes
            const phone = button.data('merchant-phone'); // Extract info from data-* attributes
            const modal = $(this);
            modal.find('.modal-title').text('Contact ' + merchant)
            modal.find('#modal-phone').text(phone)
            modal.find('#modal-email').text(email)
            modal.find('#modal-phone').attr("href", 'tel:' + phone)
            modal.find('#modal-email').attr("href", 'mailto:' + email)
        })
    </script>
{% endblock javascript %}

